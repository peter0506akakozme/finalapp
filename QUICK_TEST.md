# 通話功能快速測試指南

## 🚀 快速開始

### 步驟 1：設定 Agora 憑證

1. 前往 https://www.agora.io/ 註冊帳號
2. 創建新專案並獲取 App ID
3. 編輯 `lib/services/call_service.dart`，將 `YOUR_AGORA_APP_ID` 替換為您的真實 App ID

### 步驟 2：測試基本功能

#### 測試 1：應用程式啟動
```bash
flutter run
```
- ✅ 應用程式正常啟動
- ✅ 沒有控制台錯誤

#### 測試 2：聊天頁面
1. 登入應用程式
2. 進入聊天頁面
3. 檢查右上角是否有語音和視訊通話按鈕
- ✅ 按鈕正常顯示
- ✅ 點擊按鈕有反應

#### 測試 3：權限請求
1. 點擊語音或視訊通話按鈕
2. 檢查是否彈出權限請求對話框
- ✅ 相機權限請求
- ✅ 麥克風權限請求

#### 測試 4：通話介面
1. 接受權限後，應該進入通話介面
2. 檢查通話介面元素：
- ✅ 本地視訊預覽（視訊通話）
- ✅ 控制按鈕（靜音、視訊開關、結束通話）
- ✅ 通話狀態顯示

## 🧪 進階測試

### 雙設備測試

#### 準備工作
1. 準備兩個設備或模擬器
2. 在兩個設備上安裝應用程式
3. 使用不同的帳號登入

#### 測試步驟
1. **發起通話**：
   - 在設備 A 上點擊語音/視訊通話按鈕
   - 檢查設備 B 是否收到來電通知

2. **接受通話**：
   - 在設備 B 上接受通話
   - 檢查兩個設備是否都進入通話狀態

3. **通話功能**：
   - 測試靜音功能
   - 測試視訊開關（視訊通話）
   - 測試揚聲器切換

4. **結束通話**：
   - 任一方結束通話
   - 檢查雙方是否都退出通話介面

## 🔧 故障排除

### 常見問題

#### 1. 應用程式崩潰
**可能原因**：權限未正確設定
**解決方案**：
```bash
flutter clean
flutter pub get
flutter run
```

#### 2. 通話按鈕無反應
**可能原因**：CallService 未正確初始化
**檢查項目**：
- 檢查 `main.dart` 中是否初始化 CallService
- 檢查控制台是否有錯誤訊息

#### 3. 權限請求失敗
**可能原因**：權限描述未設定
**解決方案**：
- 檢查 `AndroidManifest.xml` 和 `Info.plist`
- 確保權限描述已正確設定

#### 4. 視訊無法顯示
**可能原因**：相機權限或 Agora 設定問題
**解決方案**：
- 檢查相機權限是否已授予
- 檢查 Agora App ID 是否正確
- 檢查網路連接

### 控制台檢查

運行應用程式時，注意以下控制台輸出：

#### 正常輸出
```
✅ Agora 引擎初始化成功
✅ Socket.IO 連接成功
✅ 成功加入頻道: [channel_name]
```

#### 錯誤輸出
```
❌ Agora 引擎初始化失敗: [error_message]
⚠️ 警告: 請先設定 Agora App ID 和 App Certificate
❌ Socket.IO 初始化失敗: [error_message]
```

## 📱 測試檢查清單

### 基本功能
- [ ] 應用程式正常啟動
- [ ] 聊天頁面顯示通話按鈕
- [ ] 點擊通話按鈕有反應
- [ ] 權限請求正常
- [ ] 通話介面正常顯示

### 通話功能
- [ ] 可以發起語音通話
- [ ] 可以發起視訊通話
- [ ] 靜音功能正常
- [ ] 視訊開關正常
- [ ] 結束通話正常

### 雙設備測試
- [ ] 來電通知正常
- [ ] 可以接受通話
- [ ] 可以拒絕通話
- [ ] 雙方通話狀態同步
- [ ] 結束通話後雙方都退出

### 錯誤處理
- [ ] 網路斷線時有適當提示
- [ ] 權限被拒絕時有適當提示
- [ ] 通話失敗時有適當提示

## 🎯 成功標準

當您完成所有測試項目並看到以下結果時，表示通話功能已成功啟用：

1. ✅ 應用程式正常運行，無崩潰
2. ✅ 通話按鈕正常響應
3. ✅ 權限請求正常
4. ✅ 通話介面正常顯示
5. ✅ 基本通話功能正常
6. ✅ 雙設備通話正常
7. ✅ 錯誤處理適當

## 📞 需要幫助？

如果遇到問題，請：

1. 檢查 `AGORA_SETUP.md` 中的詳細設定說明
2. 查看控制台錯誤訊息
3. 確認所有權限已正確設定
4. 確認 Agora 憑證已正確配置 